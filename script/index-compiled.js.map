{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/**\n * Created by cly on 17/3/10.\n */\n\nvar cheerio = require('cheerio');\n//var request = require('sync-request');\nvar request = require(\"./api/request\");\nvar fs = require('fs');\n\n//这里是举个例子而已，豆瓣的具体的电影网址可以自己替换\nvar meizitu_url = 'http://www.meizitu.com/';\n// Promise.resolve(request('GET', url))\n//   .then((response,body)=>{\n//     console.log(response);\n//     console.log(body.toString());\n//   }).catch(error=>{\n//     console.log(error);\n// });\n//封装的头部\nvar headers = {\n    \"Accept\":\"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",\n    \"Accept-Encoding\":\"gzip, deflate, sdch\",\n    \"Accept-Language\":\"zh-CN,zh;q=0.8\",\n    \"Cache-Control\":\"max-age=0\",\n    \"Connection\":\"keep-alive\",\n    \"Cookie\":\"safedog-flow-item=A10C5DA46FC6EFAEE54E4BA691B4D2E0\",\n    \"Upgrade-Insecure-Requests\":1,\n    \"User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36\",\n};\n\n//首页数据\nvar INDEX_FILE_PATH = \"meizi_index.txt\";\n\nfunction captureMeizi() {\n    var exist = fs.existsSync(INDEX_FILE_PATH);\n\n    loadMeizHtml(exist)\n    .then(data=>{\n        analysisMezi(data);\n      })\n      .catch(error=>{\n        console.log(\"错误信息：\"+error);\n      })\n\n}\n\nfunction loadMeizHtml(exists) {\n  if(exists){\n    return loadByTxt();\n  }\n  else{\n    return loadByRequest();\n  }\n}\n\n//通过网络抓取\nfunction loadByRequest() {\n  return request(headers).get(meizitu_url)\n    .then((response)=>{\n      if(response.status == 200){\n        console.log(\"request的头部\",response.config.headers);\n        console.log(\"response的头部\",response.headers);\n        var data = response.data;\n        //写入文档\n        Promise.all([fs.appendFile(INDEX_FILE_PATH,data,'utf-8')])\n          .then(resolve=>{\n            console.log(data,\"信息写入成功\")})\n          .catch(error=>console.log(error));\n\n        return Promise.resolve(response.data);\n      }\n      else{\n        return Promise.reject({status:response.status}) ;\n      }\n      // console.log(body.toString());\n    }).catch(error=>{\n      return Promise.reject(error);\n  });\n}\n\n//通过本地文档抓取\nfunction loadByTxt() {\n  //同步读取文件\n  var text = fs.readFileSync(INDEX_FILE_PATH, 'utf8');\n  return Promise.resolve(text);\n  //异步读取文件\n  // Promise.all([fs.readFile(INDEX_FILE_PATH)])\n  //   .then(buffer=>{\n  //     return Promise.resolve(process(buffer))\n  //   }).catch(error=>{\n  //     return Promise.reject(error);\n  // })\n}\n\n\n\n//\n// var request = request('GET', url);\n// console.log(request)\n// var html = request.getBody().toString();\nfunction analysisMezi(html) {\n  //html存入txt文档\n  Promise.all([fs.appendFile(\"meizi_index.txt\",html,'utf-8')])\n    .then(resolve=>{\n      console.log(data,\"信息写入成功\")})\n    .catch(error=>console.log(error));\n\n  var $ = cheerio.load(html); //引入cheerio的方法。这样的引入方法可以很好的结合jQuery的用法。\n  var maincontent = $.find(\"maincontent\");\n  console.log(maincontent);\n  //var a_list =\n\n  // $(\"div.postContent\").each(function (idx,element) {\n  //   var $element = $(element);\n  //   var picture = $element.find(\"picture\");\n  //   console.log(picture);\n  // });\n\n}\n\n\nfunction handleDB(html){\n  var $ = cheerio.load(html); //引入cheerio的方法。这样的引入方法可以很好的结合jQuery的用法。\n  var info = $('#info');\n  // 获取电影名\n  var movieName = $('#content>h1>span').filter(function(i,el){\n    return $(this).attr('property') === 'v:itemreviewed';\n  }).text();\n  // 获取影片导演名\n  var directories = '- 导演：' + $('#info span a').filter(function(i,el){\n      return $(this).attr('rel') === 'v:directedBy';\n    }).text();\n  // 获取影片演员\n  var starsName = '- 主演：';\n  $('.actor .attrs a').each(function(i,elem){\n    starsName += $(this).text() + '/';\n  });\n  // 获取片长\n  var runTime = '- 片长：' + $('#info span').filter(function(i,el){\n      return $(this).attr('property') === 'v:runtime';\n    }).text();\n  // 获取影片类型\n  var kind = $('#info span').filter(function(i,el){\n    return $(this).attr('property') === 'v:genre'\n  }).text();\n  // 处理影片类型数据\n  var kLength = kind.length;\n  var kinds = '- 影  片类型：';\n  for (let i = 0; i < kLength; i += 2){\n    kinds += kind.slice(i,i+2) + '/';\n  }\n  // 获取电影评分和电影评分人数\n  // 豆瓣\n  var DBScore = $('.ll.rating_num').text();\n  var DBVotes = $('a.rating_people>span').text().replace(/\\B(?=(\\d{3})+$)/g,',');\n  var DB = '- 豆  瓣评分：' + DBScore + '/10' + '(' + 'from' + DBVotes + 'users' + ')';\n  // IMDBLink\n  let IMDBLink = $('#info').children().last().prev().attr('href');\n\n  var data = movieName + '\\r\\n' + directories + '\\r\\n' + starsName + '\\r\\n' + runTime + '\\r\\n' + kinds + '\\r\\n'+ DB +'\\r\\n';\n\n  Promise.all([fs.appendFile(\"dbmovie.txt\",data,'utf-8')])\n    .then(resolve=>{\n      console.log(data,\"信息写入成功\")})\n    .catch(error=>console.log(error));\n  // 输出文件\n  // fs.appendFile('dbmovie.txt', data, 'utf-8', function(err){\n  //   if (err) throw err;\n  //   else console.log('大体信息写入成功'+'\\r\\n' + data)\n  // });\n}\n\n\n\n\n//handleDB(html);\n\ncaptureMeizi();"]}