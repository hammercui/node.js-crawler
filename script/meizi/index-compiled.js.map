{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/**\n * Created by cly on 17/3/22.\n */\n\"use strict\";\nvar request = require(\"../api/request\");\nvar iconv = require('iconv-lite');\nvar cookie = \"safedog-flow-item=4D72DD1431AFCC72F5CEC36D4F5EF70B\";\nvar baseUrl = 'http://www.meizitu.com/';\nvar fs = require('fs');\n\n//var dao = require(\"./db\");\nimport crawlerFactory from \"./crawlerFactory-compiled\";\nvar crawler = new crawlerFactory();\n\n\n\n//封装html的request头部\nvar htmlHeaders = {\n  \"Accept\":\"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",\n  \"Accept-Encoding\":\"gzip, deflate, sdch\",\n  \"Accept-Language\":\"zh-CN,zh;q=0.8\",\n  \"Cache-Control\":\"max-age=0\",\n  \"Connection\":\"keep-alive\",\n // \"Cookie\":cookie,\n  \"Upgrade-Insecure-Requests\":1,\n  \"Host\":\"www.meizitu.com\",\n  \"User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) \" +\n  \"AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36\",\n};\n\n//封装image的request头部\nvar imageHeaders = {\n  \"Accept\":\"image/webp,image/*,*/*;q=0.8\",\n  \"Accept-Encoding\":\"gzip, deflate, sdch\",\n  \"Accept-Language\":\"zh-CN,zh;q=0.8\",\n  \"Cache-Control\":\"max-age=0\",\n  \"Connection\":\"keep-alive\",\n  \"Cookie\":cookie,\n  \"Upgrade-Insecure-Requests\":1,\n  \"Host\":\"mm.howkuai.com\",\n  \"User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) \" +\n  \"AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36\",\n};\n//编码格式\nvar charset = \"gb2312\";\n\n\nconst index_options = {\n  responseType:\"arraybuffer\",\n  timeout: 10000,\n  headers: htmlHeaders,\n  // proxy: {\n  //   host: '127.0.0.1',\n  //   port: 9743,\n  // },//代理\n};\n\n\nvar image_options = {\n  timeout: 10000,\n  responseType:\"stream\",//二进制\n  headers:imageHeaders,\n  // proxy: {\n  //   host: '127.0.0.1',\n  //   port: 9743,\n  // },//代理\n}\n\n\n\n//抓取妹子\nfunction captureMeizi() {\n  request(index_options).get(baseUrl)\n    .then(response=>{\n      if(response.status == 200){\n        return Promise.resolve(response.data);\n      }\n      else{\n        var error = {status:response.status,msg:response.statusText};\n        return Promise.reject(error);\n      }\n    })\n    .then(resolve=>{\n      var html = iconv.decode(resolve,\"gb2312\");\n       analysisMezi(html);\n    },\n      reject=>Promise.reject(reject)\n    )\n    .catch(error=>{\n      console.log(\"错误信息：\"+error);\n    })\n}\n\nfunction analysisMezi(html) {\n  //打开数据库\n // var dbInstance;\n  // dao.connectDB()\n  //   .then(db=>{\n  //     dbInstance = db;\n  //   }).catch(error=>console.log(error));\n  //\n  // console.log(imageArray);\n  //\n  // dao.selectData(dbInstance,\"homePage\",{imgSrc:imgSrc})\n  //   .then(result=>{\n  //\n  //   })\n  //   .catch(error=>{\n  //     console.log(\"查询\",error);\n  //     dao.insertData(dbInstance,\"homePage\",imageItem)\n  //       .then(result=>{\n  //         console.log(\"插入数据\",result);\n  //       })\n  //       .then(error=>{\n  //         console.log(\"插入\",error);\n  //       })\n  //   });\n\n  //写入文档\n  //var str = JSON.stringify(imageArray);\n\n  console.log(crawler.analysisIndex(html));\n\n  // fs.writeFile(\"../../data/index.json\",str,function (error) {\n  //   if(error){\n  //     console.log('写入json失败：'+error.toString());\n  //     return ;\n  //   }\n  //   console.log('写入json成功：');\n  // });\n  //写入数据库\n\n}\n\n\n\nfunction downloadImg() {\n  var json = require(\"../../data/index.json\");\n  Promise.all(json.map(imageItem=>{\n      return request(image_options).get(imageItem.imgSrc)\n        .then(response=>{\n            if(response.status == 200){\n              return Promise.resolve(response.data)\n            }\n            else{\n              var error = {status:response.status,msg:response.statusText};\n              return Promise.reject(error);\n            }\n        })\n        .then(body=>{\n          //创建写入流\n          var writerStream = fs.createWriteStream(\"../../image/\"+imageItem.imgName);\n          writerStream.on('finish', function() {\n            console.log(imageItem.imgName+\"下载成功！\");\n            return Promise.resolve(imageItem);\n          });\n\n          writerStream.on('error', function(err){\n            console.log(err.stack);\n            console.log(imageItem.imgName+\"下载失败！\",err.stack);\n            return Promise.reject(imageItem.imgSrc);\n          });\n          body.pipe(writerStream);\n        })\n  }))\n    .then(result=>{\n      //result是数组\n      console.log(\"result success:\",result);\n    })\n    .catch(error=>{\n      console.log(\"result error:\",error);\n    });\n}\n\n\ncaptureMeizi();\n//downloadImg();"]}