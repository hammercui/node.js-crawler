{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/**\n * Created by cly on 17/3/10.\n */\n'use strict';\nvar cheerio = require('cheerio');\nvar request = require(\"request\");\nvar requestProgress = require(\"request-progress\");\nvar download  = require(\"download\");\n//var request = require(\"./api/request\");\nvar iconv = require('iconv-lite');\nvar fs = require('fs');\n//编码格式\nvar charset = \"gb2312\";\n\nglobal.cookie = \"__jsluid=4ed82ed90a22a44e3b0b08ca4dc7df58\";\n\n//这里是举个例子而已，豆瓣的具体的电影网址可以自己替换\nvar meizitu_url = 'http://www.meizitu.com/';\n//封装html的request头部\nvar htmlHeaders = {\n    \"Accept\":\"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",\n    \"Accept-Encoding\":\"gzip, deflate, sdch\",\n    \"Accept-Language\":\"zh-CN,zh;q=0.8\",\n    \"Cache-Control\":\"max-age=0\",\n    \"Connection\":\"keep-alive\",\n    \"Cookie\":global.cookie,\n    \"Upgrade-Insecure-Requests\":1,\n    \"Host\":\"www.meizitu.com\",\n    \"User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) \" +\n    \"AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36\",\n};\n//封装image的request头部\nvar imageHeaders = {\n  \"Accept\":\"image/webp,image/*,*/*;q=0.8\",\n  \"Accept-Encoding\":\"gzip, deflate, sdch\",\n  \"Accept-Language\":\"zh-CN,zh;q=0.8\",\n  \"Cache-Control\":\"max-age=0\",\n  \"Connection\":\"keep-alive\",\n  \"Cookie\":global.cookie,\n  \"Upgrade-Insecure-Requests\":1,\n  \"Host\":\"mm.howkuai.com\",\n  \"User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) \" +\n  \"AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36\",\n};\n\n\n\n//request请求options\nvar htmlOptions = {\n  encoding:null,\n  headers:htmlHeaders,\n  //代理服务器\n  //proxy: 'http://xxx.xxx.xxx.xxx:8888',\n}\nvar imageOptions = {\n  encoding:\"binary\",//二进制\n  headers:imageHeaders,\n}\n\n//首页数据存档\nvar DATA_INDEX_FILE = \"./data/meizi_index.txt\";\n\n//抓取妹子\nfunction captureMeizi() {\n    var exist = fs.existsSync(DATA_INDEX_FILE);\n    loadMeizHtml(exist)\n    .then(data=>{\n        analysisMezi(data);\n      })\n      .catch(error=>{\n        console.log(\"错误信息：\"+error);\n      })\n}\n\nfunction loadMeizHtml(exists) {\n  // if(exists){\n  //   return loadByTxt();\n  // }\n  // else{\n    return loadByRequest();\n  //}\n}\n\n//通过网络抓取\nfunction loadByRequest() {\n  //异步网络请求\n  return new Promise(function (resolve,reject) {\n          request(meizitu_url,htmlOptions,function (error,response) {\n            if(error)\n              return reject(error);\n            //请求成功\n            if(response.statusCode == 200){\n              //更新token\n              var responseHeader = response.toJSON().headers;\n              if(responseHeader.hasOwnProperty(\"set-cookie\")){\n                var cookie = responseHeader[\"set-cookie\"][0].split(\";\")[0];\n                if(cookie){\n                  global.cookie = cookie;\n                  console.log(cookie);\n                }\n              }\n              var html = iconv.decode(response.body,charset) ;\n              return resolve(html);\n          }\n          else{\n            var error= {statusCode:response.statusCode,statusMessage:response.statusCode};\n            reject(error);\n          }\n        });\n  })\n    // //再存入\n    // .then(html=>{\n    //   return Promise.resolve(fs.writeFile(DATA_INDEX_FILE,html);\n    // });\n}\n\n//通过本地文档抓取\nfunction loadByTxt() {\n  //同步读取文件\n  var text = fs.readFileSync(DATA_INDEX_FILE);\n  return Promise.resolve(text);\n}\n\n\n\nfunction analysisMezi(html) {\n  var $ = cheerio.load(html); //引入cheerio的方法。这样的引入方法可以很好的结合jQuery的用法。\n  var postContentList = $(\"#maincontent\").find(\".postContent\");\n  var imageArray = new Array();\n  postContentList.each(function (idx,element) {\n    var postContent = $(this);\n    var a = $(postContent).find(\"a\");\n    var href = $(a).attr(\"href\");\n    var title = $(a).attr(\"title\");\n    var img = $(a).find(\"img\");\n    var imgSrc = $(img).attr(\"src\");\n    var tempArray = imgSrc.split(\"uploads\");\n    var imgNameTemp = tempArray[tempArray.length - 1].toString();\n    var imgName = imgNameTemp.replace(/\\//g,\"\");\n    var image = {href:href,title:title,imgSrc:imgSrc,imgName:imgName};\n    imageArray.push(image);\n  })\n  console.log(imageArray);\n  var str = JSON.stringify(imageArray);\n  //写入文档\n  fs.writeFile(\"./data/index.json\",str,function (error) {\n    if(error){\n      console.log('写入json失败：'+error.toString());\n    }\n    console.log('写入json成功：');\n  });\n  //console.log(\"imageArray count:\"+imageArray.length);\n}\n\n\nfunction downloadImg() {\n  var json = require(\"./../../data/index.json\");\n  Promise.all(\n    json.map(imageItem=>{\n      //下载\n      return new Promise(function (resolve,reject) {\n        request.get(imageItem.imgSrc,imageOptions,function (error,res,body) {\n          //错误\n          if(error)\n            return reject(error);\n          return resolve(body);\n        })\n      })\n        .then(body=>{\n          fs.writeFileSync(\"./image/\"+imageItem.imgName, body, 'binary');\n          console.log(imageItem.imgName+\"下载成功！\");\n          return Promise.resolve(imageItem.imgName+\"下载成功！\");\n        })\n        .catch(error=>{\n          return Promise.resolve(error);\n        })\n\n    })\n  ).then((result)=>{\n\n  }).catch(error=>{\n    console.log(\"下载错误\",error)\n  });\n}\n\ncaptureMeizi();\n//downloadImg();\n//downloadImageWithProgress();"]}